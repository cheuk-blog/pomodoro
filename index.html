<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>極簡番茄鐘</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: #f8f9fa;
      font-family: system-ui, -apple-system, sans-serif;
      color: #333;
    }
    h1 {
      font-size: 1.2rem;
      margin: 0 0 2rem;
      opacity: 0.6;
      letter-spacing: 0.3em;
    }
    #time {
      font-size: 8rem;
      font-weight: 300;
      letter-spacing: -0.05em;
      margin: 0;
      user-select: none;
    }
    .controls {
      margin-top: 2.5rem;
      display: flex;
      gap: 1.5rem;
    }
    button {
      background: transparent;
      border: 2px solid #333;
      color: #333;
      padding: 0.8rem 1.8rem;
      font-size: 1.1rem;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.2s;
    }
    button:hover {
      background: #333;
      color: white;
    }
    button.active {
      background: #333;
      color: white;
    }
    .mode-buttons {
      margin-bottom: 2rem;
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .mode-btn {
      background: transparent;
      border: none;
      font-size: 1.1rem;
      color: #777;
      cursor: pointer;
      padding: 0.5rem 1.2rem;
      border-radius: 999px;
      transition: all 0.2s;
    }
    .mode-btn.active {
      color: #333;
      background: rgba(0,0,0,0.08);
    }
    #custom-input {
      display: none;
      margin-top: 1rem;
      text-align: center;
    }
    #custom-input input {
      width: 80px;
      font-size: 1.2rem;
      padding: 0.5rem;
      text-align: center;
      border: 2px solid #ccc;
      border-radius: 8px;
    }
    #custom-save {
      margin-left: 0.8rem;
      padding: 0.6rem 1.2rem;
    }
  </style>
</head>
<body>

  <h1>極簡番茄鐘</h1>

  <div class="mode-buttons">
    <button class="mode-btn active" data-min="55">專注 55</button>
    <button class="mode-btn" data-min="15">短休 15</button>
    <button class="mode-btn" data-min="30">長休 30</button>
    <button class="mode-btn" id="custom-btn">自訂</button>
  </div>

  <div id="custom-input">
    <input type="number" id="custom-min" min="1" max="180" placeholder="分鐘" />
    <button id="custom-save">儲存並使用</button>
  </div>

  <div id="time">55:00</div>

  <div class="controls">
    <button id="start">開始</button>
    <button id="reset">重置</button>
  </div>

  <script>
    let timer;
    let timeLeft = 55 * 60;
    let isRunning = false;
    let currentMode = '55'; // 預設為專注55分鐘

    const timeDisplay = document.getElementById('time');
    const startBtn = document.getElementById('start');
    const resetBtn = document.getElementById('reset');
    const modeBtns = document.querySelectorAll('.mode-btn:not(#custom-btn)');
    const customBtn = document.getElementById('custom-btn');
    const customInput = document.getElementById('custom-input');
    const customMin = document.getElementById('custom-min');
    const customSave = document.getElementById('custom-save');

    // 從 localStorage 載入自訂時間（如果有）
    const savedCustom = localStorage.getItem('pomodoroCustomMin');
    let customValue = savedCustom ? parseInt(savedCustom) : 55;

    function updateDisplay() {
      const min = Math.floor(timeLeft / 60);
      const sec = timeLeft % 60;
      timeDisplay.textContent = `${min.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
      document.title = timeDisplay.textContent + ' | 番茄鐘';
    }

    function startTimer() {
      if (isRunning) {
        clearInterval(timer);
        startBtn.textContent = '繼續';
        isRunning = false;
      } else {
        timer = setInterval(() => {
          timeLeft--;
          updateDisplay();
          if (timeLeft <= 0) {
            clearInterval(timer);
            alert('時間到！休息一下吧～');
            isRunning = false;
            startBtn.textContent = '開始';
          }
        }, 1000);
        startBtn.textContent = '暫停';
        isRunning = true;
      }
    }

    function resetTimer() {
      clearInterval(timer);
      timeLeft = parseInt(currentMode) * 60;
      updateDisplay();
      isRunning = false;
      startBtn.textContent = '開始';
    }

    function changeMode(e) {
      currentMode = e.target.dataset.min;
      timeLeft = parseInt(currentMode) * 60;
      updateDisplay();
      resetTimer();

      modeBtns.forEach(btn => btn.classList.remove('active'));
      customBtn.classList.remove('active');
      e.target.classList.add('active');
      customInput.style.display = 'none';
    }

    function activateCustom() {
      currentMode = customValue.toString();
      timeLeft = customValue * 60;
      updateDisplay();
      resetTimer();

      modeBtns.forEach(btn => btn.classList.remove('active'));
      customBtn.classList.add('active');
      customInput.style.display = 'block';
      customMin.value = customValue;
    }

    function saveCustom() {
      const newMin = parseInt(customMin.value);
      if (isNaN(newMin) || newMin < 1 || newMin > 180) {
        alert('請輸入 1～180 分鐘之間的數字');
        return;
      }
      customValue = newMin;
      localStorage.setItem('pomodoroCustomMin', customValue);
      currentMode = customValue.toString();
      timeLeft = customValue * 60;
      updateDisplay();
      resetTimer();
      alert('自訂時間已儲存！');
    }

    startBtn.addEventListener('click', startTimer);
    resetBtn.addEventListener('click', resetTimer);
    modeBtns.forEach(btn => btn.addEventListener('click', changeMode));
    customBtn.addEventListener('click', activateCustom);
    customSave.addEventListener('click', saveCustom);

    // 初始載入：檢查是否有自訂值，否則用預設55
    if (savedCustom) {
      customValue = parseInt(savedCustom);
      currentMode = customValue.toString();
      timeLeft = customValue * 60;
      customBtn.textContent = `自訂 ${customValue}`;
    }

    updateDisplay();
  </script>

</body>
</html>
